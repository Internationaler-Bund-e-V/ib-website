!function($){$.fn.myFormBuilderBackend=function(options){var that=this,options=(settings=$.extend({formBuilderOptions:{subtypes:{paragraph:["div"]},showActionButtons:!1,disableFields:["autocomplete","header","file","date"],disabledAttrs:["inline","className","access","description","placeholder","maxlength","other","checked","style"],typeUserAttrs:{"radio-group":{dataLocalValue:{label:"Abh채ngigkeiten verwalten","data-mytype":"dependencyManager",autocomplete:"off",readonly:"readonly"}}},defaultFields:[{label:"Absenden",type:"button",subtype:"submit",name:"submit-button-default",disabledFieldButtons:["remove","other","style"]}],typeUserEvents:{button:{onadd:function(fld){"submit-button-default"==$(".fld-name",fld).val()&&(jQuery(fld).find("select[name=subtype]").prop("disabled",!0),jQuery(fld).find("input[name=name]").prop("disabled",!0),jQuery(fld).find("input[name=value]").prop("disabled",!0))}},paragraph:{onadd:function(fld){$(".fld-name",fld)}},"radio-group":{onadd:function(fld){}}},fieldRemoveWarn:!0,i18n:{locale:"de-DE"},dataType:"json"},ibFormBuilderDataHolder:"formbuilder-data-holder"},options),jQuery("textarea#ib-formbuilder-formdataJson").text()),fbOtions=settings.formBuilderOptions;return fbOtions.formData=options,fbEditor=document.getElementById(settings.ibFormBuilderDataHolder),(formBuilder=jQuery(fbEditor).formBuilder(fbOtions)).promise.then(function(fb){that.addBackendSubmitClickHandler(),that.dependenciesHandler()}),this},$.fn.addBackendSubmitClickHandler=function(){jQuery("#tx_ibformbuilder-getJSON").length&&document.getElementById("tx_ibformbuilder-getJSON").addEventListener("click",function(){var actualJson=formBuilder.actions.getData("json");jQuery("textarea#ib-formbuilder-formdataJson").text(actualJson),jQuery("form.tx_ibformbuilder-submit-external").submit()})},$.fn.dependencyRadioClickHandler=function(event){},$.fn.openDependencyWindow=function(id){var currentTarget=jQuery("#"+id),parentLabel=((id=jQuery("div#tx_formbuilder_backend_manage_dependencies")).show(),jQuery(currentTarget).closest("li.radio-group-field").find("label.field-label").html()),parentName=jQuery(currentTarget).closest("div.form-elements").find("input[name=name]").val(),formDataJson=jQuery.parseJSON(formBuilder.formData),actualInputValueArray=jQuery(currentTarget).val().split(";"),availableLocalOptions=[],localRemoteAssgnmentArray=(jQuery(currentTarget).closest("div.form-elements").find("ol.sortable-options input.option-value").each(function(key,value){availableLocalOptions.push(jQuery(value).val())}),[]),availableString=(jQuery(actualInputValueArray).each(function(key,value){value=value.split("#"),localRemoteAssgnmentArray[value[1]]=value[0]}),"");jQuery(availableLocalOptions).each(function(key,value){availableString=availableString+'<li class="margin-top">\t\t\t\t\tBei Klick auf den Radio-Button <b>'+value+"</b> in der Gruppe "+parentLabel+" wird das folgende Feld eingeblendet: \t\t\t\t</li><ul>",jQuery(formDataJson).each(function(formDataKey,formDataValue){var mylabel=formDataValue.label+" ("+formDataValue.name+")",isButton="button"===formDataValue.type,isParagraph="paragraph"===formDataValue.type,isSelf=formDataValue.name===parentName;isButton||isParagraph||isSelf||(isButton="",localRemoteAssgnmentArray[formDataValue.name]===value&&(isButton='checked="checked"'),availableString+="<li> \t\t\t\t\t\t\t<input \t\t\t\t\t\t\t\t"+isButton+' \t\t\t\t\t\t\t\tclass="dependency_management_radio" \t\t\t\t\t\t\t\ttype="radio" \t\t\t\t\t\t\t\tid="depend_'+value+"_"+formDataValue.name+'"\t\t\t\t\t\t\t\tname="depend_'+value+'" \t\t\t\t\t\t\t\tvalue="'+formDataValue.name+'"\t\t\t\t\t\t\t\tdata-parent-name="'+value+'"/> \t\t\t\t\t\t\t<label for="depend_'+value+"_"+formDataValue.name+'">'+mylabel+" </label> \t\t\t\t\t\t</li>")}),availableString+="</ul>"}),id.find("div.dependency_control_section ul").empty().append(availableString),id.find("h3 span").html(parentLabel),jQuery("input:radio.dependency_management_radio").change(function(){var myResult=[],combinedResult=(jQuery(".dependency_management_radio:checked").each(function(key,value){myResult.push(jQuery(this).data("parent-name")+"#"+jQuery(value).val())}),myResult.join(";"));jQuery(currentTarget).val(combinedResult)}),jQuery("a#remove_dependencies_link").click(function(e){e.preventDefault(),!0===confirm("sollen die bisherigen Abh채ngigkeiten entfernt werden?")&&(jQuery(currentTarget).val(""),jQuery("div#tx_formbuilder_backend_manage_dependencies").hide(),alert("die Abh채ngigkeiten wurden entfernt"))})},$.fn.dependenciesHandler=function(){var that=this,dependencyContainer=jQuery("div#tx_formbuilder_backend_manage_dependencies");jQuery('input[data-mytype="dependencyManager"]').each(function(key,inputField){inputField=jQuery(inputField).attr("id"),jQuery('<div class="manage-dependency-link-container"><a class="open-dependency-manager" \t\t\t\t\tdata-id="'+inputField+'"\t\t\t\t\thref="#">\t\t\t\t\t\tAbh채ngigkeiten verwalten\t\t\t\t</a></div>').insertBefore(this)}),jQuery("div.manage-dependency-link-container a.open-dependency-manager").click(function(e){e.preventDefault(),e=jQuery(this).data("id"),that.openDependencyWindow(e)}),jQuery('input[data-mytype="dependencyManager"]').click(function(e){e.preventDefault(),that.openDependencyWindow(jQuery(e.currentTarget).attr("id"))}),dependencyContainer.find("a.close-overlay").click(function(e){e.preventDefault(),jQuery("div#tx_formbuilder_backend_manage_dependencies").hide()})}}(jQuery);