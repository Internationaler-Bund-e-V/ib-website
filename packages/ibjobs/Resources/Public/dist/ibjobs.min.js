var jobs,jobContainer,results,jobTemplate,srJobTemplate,lazyMarker,alternateClass,resultCounter,regex,clients,stickyWidth,scrollIndicator,ibHeader,distance,targetPage,baseUrl,jobtype="IB",trfTemplate="",$window=$(window),lazyOffset=0,currentJob=0,currentResults=0,searchExtended=!1,extendedFilterActive=!1;function isScrolledIntoView(e){var e=$(e),t=(s=$(window)).scrollTop(),s=t+s.height(),a=e.offset().top-lazyOffset;return a+e.height()<=s&&t<=a}function searchTerms(s,e){if(results=[],e=void 0!==e&&e)$.each(jobs,function(e,t){"true"!=s[0].text&&t[s[0].val]!=s[0].text||"true"!=s[1].text&&t[s[1].val]!=s[1].text||"true"!=s[2].text&&t[s[2].val]!=s[2].text||results.push(jobs[e])});else{s=s.match(/\S+/g);var a="";if(s&&s.length){for(var t=s.length,i=0;i<t;i++)s[i]=s[i].replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),a+="(?=.*"+s[i]+")";$.each(jobs,function(e,t){regex=new RegExp(a,"i"),-1!=t[15].search(regex)&&results.push(jobs[e])})}else results=jobs}initJobs()}function addJobRow(e){trfTemplate="1"==e[10]&&""!=e[9]?'<span class="ib-font-size-12">TRF Bez: '+e[9]+"</span>":"","HAUFE"==e[13]?this.jobTemplate='<div class="'+this.alternateClass+' animateJob row"><div class="ib-jobs-description columns small-12 medium-8"><span class="hide-for-small-only">'+e[6]+" | "+e[2]+'</span><a href="'+e[14]+'" target="_blank"">'+e[0]+"</a>"+trfTemplate+'<span class="hide-for-small-only ib-font-size-12">Chiffre: '+e[3]+'</span></div><div class="ib-jobs-location columns small-12 medium-4"><span>'+e[1]+'</span><span class="hide-for-small-only"><span class="RS_MESSAGE">\x3c!-- Bundesland --\x3e</span>'+e[4]+'</span><span class="ib-font-size-12">Veröffentlicht am: '+e[5]+"</span></div></div>":this.jobTemplate='<div class="'+this.alternateClass+' animateJob row"><div class="ib-jobs-description columns small-12 medium-8"><span class="hide-for-small-only">'+e[6]+" | "+e[2]+'</span><a href="'+targetPage+"/"+e[7]+'" target="_blank"">'+e[0]+"</a>"+trfTemplate+'<span class="hide-for-small-only ib-font-size-12">Chiffre: '+e[3]+'</span></div><div class="ib-jobs-location columns small-12 medium-4"><span>'+e[1]+'</span><span class="hide-for-small-only"><span class="RS_MESSAGE">\x3c!-- Bundesland --\x3e</span>'+e[4]+'</span><span class="ib-font-size-12">Veröffentlicht am: '+e[5]+"</span></div></div>",jobContainer.append(this.jobTemplate),"odd"==this.alternateClass?this.alternateClass="even":this.alternateClass="odd",currentJob++}function initJobs(){jobContainer.empty(),currentJob=0,currentResults=results.length,limit=1e3,results.length<limit&&(limit=results.length),results.length;for(var e=0;e<limit;e++)addJobRow(results[e]);updateResults()}function resetSearch(){$("#ib-jobs-search").val(""),$("select").prop("selectedIndex",0),searchTerms("")}function updateResults(){resultCounter.html(results.length)}function checkFixed(){0==(ibHeader=$("#ib-header")).height()&&(ibHeader=$(".jetmenu")),(distance=$("#toStick").offset().top-ibHeader.offset().top)<=ibHeader.height()?($(".ib-jobs-search-container").addClass("ib-jobs-sticky"),searchExtended?$("#ib-jobs-lazy-container").addClass("ib-job-container-spacer-extended"):$("#ib-jobs-lazy-container").addClass("ib-job-container-spacer-default")):($(".ib-jobs-search-container").removeClass("ib-jobs-sticky"),$("#ib-jobs-lazy-container").removeClass("ib-job-container-spacer-extended"),$("#ib-jobs-lazy-container").removeClass("ib-job-container-spacer-default")),$(".ib-jobs-search-container").hasClass("ib-jobs-sticky")&&$(".ib-jobs-search-container").css("top",ibHeader.height())}function setEvents(){$(".ib-jobs-extended-search-container").on("click",function(){searchExtended=!searchExtended,$(".ib-jobs-container #ib-jobs-extended-search").toggleClass("searchActive"),$(".ib-jobs-container .ib-jobs-extended-search-container i").toggleClass("ib-icon-arrow-right ib-icon-arrow-down")});var e=makeDelay(350);$("#ib-jobs-search").keyup(function(){e(function(){searchTerms($("#ib-jobs-search").val())})}),$(".ib-jobs-ext-filter").on("change",function(){searchTerms(prepareExtFilterTerm(),!0)}),$("#ib-jobs-reset").on("click",function(){resetSearch()}),$(window).resize(function(){setStickyWidth()})}function prepareExtFilterTerm(){var a=[];return $.each($(".ib-jobs-ext-filter"),function(e,t){var t=$(this).data("val"),s={};0!==$("option:selected",this).index()?(s.val=t,s.text=$("option:selected",this).text()):(s.val=t,s.text="true"),a.push(s)}),a}function setStickyWidth(){var e=$("#toStick").width();$(".searchHeader").css("max-width",e)}function checkScrollIndicator(){currentJob==currentResults?scrollIndicator.fadeOut():scrollIndicator.fadeIn()}function makeDelay(t){var s=0;return function(e){clearTimeout(s),s=setTimeout(e,t)}}$(document).ready(function(){lazyMarker=$(".ib-footer-social"),jobContainer=$("#ib-jobs-lazy-container"),alternateClass="odd",resultCounter=$("#ib-jobs-results-count"),scrollIndicator=$(".ib-jobs-scroll-indicator"),targetPage=$("#ib-jobs-data").data("target"),clients=$("#ib-jobs-data").data("clients"),srclients=$("#ib-jobs-data").data("srclients"),intern=$("#ib-jobs-data").data("intern"),locations=$("#ib-jobs-data").data("locations"),categories=$("#ib-jobs-data").data("categories"),titles=$("#ib-jobs-data").data("titles"),prefilter=$("#ib-jobs-data").data("prefilter"),rmBaseUrl=$("#ib-jobs-data").data("baseurl"),baseUrl="/typo3conf/ext/ibjobs/Resources/Public/php/proxy.php?",requestURL="",requestURL="1"==prefilter?baseUrl+"clients="+clients+"&sr_clients="+srclients+"&intern="+intern+"&locations="+locations+"&categories="+categories+"&titles="+titles+"&baseurl="+rmBaseUrl:baseUrl+"clients="+clients+"&sr_clients="+srclients+"&intern="+intern+"&baseurl="+rmBaseUrl,$.ajax({url:requestURL,context:document.body}).done(function(e){$(".ib-jobs-loader, .ib-jobs-container").toggle(),setStickyWidth(),jobs=(jobs=JSON.parse(e)).data,results=jobs,initJobs(),setEvents(),$window.scroll(function(){$(".ib-jobs-search-container").is(":visible")&&checkFixed()})})});