!function(g){g.ibMap=function(t,e){defaults={w:960,h:500,minZoom:0,maxZoom:0,countriesGroup:[],circleGroup:[],allLocations:[],projection:null,path:null,zoom:null,svg:null,gradient_colors:["red","blue","yellow"],grad_red_blue:null,grad_blue_yellow:null,grad_red_yellow:null,grad_red_blue_yellow:null,foo:"bar",onFoo:function(){}},(plugin=this).settings={},$element=g(t),plugin.init=function(){plugin.settings=g.extend({},defaults,e),plugin.settings.svg=d3.select("#map-holder").append("svg").attr("width",jQuery("#map-holder").width()).attr("height",jQuery("#map-holder").height()),plugin.settings.countriesGroup=plugin.settings.svg.append("g").attr("id","map"),plugin.settings.circleGroup=plugin.settings.svg.append("g").attr("id","map"),plugin.settings.zoom=d3.zoom().on("zoom",zoomed),d3.select("#map-holder").call(plugin.settings.zoom),plugin.settings.projection=d3.geoMercator().center([10,51]).scale(2300).translate([plugin.settings.w/2,plugin.settings.h/2]),plugin.settings.path=d3.geoPath().projection(plugin.settings.projection),plugin.settings.grad_red_blue=plugin.settings.svg.append("defs").append("linearGradient").attr("id","grad_red_blue").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[0]).append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[1]),plugin.settings.grad_blue_yellow=plugin.settings.svg.append("defs").append("linearGradient").attr("id","grad_blue_yellow").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[1]).append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[2]),plugin.settings.grad_red_yellow=plugin.settings.svg.append("defs").append("linearGradient").attr("id","grad_red_yellow").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[0]).append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[2]),plugin.settings.grad_red_blue_yellow=plugin.settings.svg.append("defs").append("linearGradient").attr("id","grad_red_blue_yellow").attr("x1","0%").attr("x2","0%").attr("y1","100%").attr("y2","0%").append("stop").attr("offset","25%").style("stop-color",plugin.settings.gradient_colors[0]).append("stop").attr("offset","50%").style("stop-color",plugin.settings.gradient_colors[1]).append("stop").attr("offset","75%").style("stop-color",plugin.settings.gradient_colors[2])},plugin.foo_public_method=function(){},foo_private_method=function(){},zoomed=function(){var t=d3.event.transform;plugin.settings.countriesGroup.attr("transform","translate("+[t.x,t.y]+")scale("+t.k+")"),plugin.settings.circleGroup.attr("transform","translate("+[t.x,t.y]+")scale("+t.k+")"),plugin.settings.svg.selectAll("circle").attr("d",plugin.settings.path.projection(plugin.settings.projection)).attr("r",5/d3.event.transform.k)},getTextBox=function(t){t.each(function(t){t.bbox=this.getBBox()})},initiateZoom=function(){plugin.settings.minZoom=Math.max(jQuery("#map-holder").width()/plugin.settings.w,jQuery("#map-holder").height()/plugin.settings.h),plugin.settings.maxZoom=20*plugin.settings.minZoom,plugin.settings.zoom.scaleExtent([plugin.settings.minZoom,plugin.settings.maxZoom]).translateExtent([[0,0],[plugin.settings.w,plugin.settings.h]]);var t=(jQuery("#map-holder").width()-plugin.settings.minZoom*plugin.settings.w)/2,e=(jQuery("#map-holder").height()-plugin.settings.minZoom*plugin.settings.h)/2;plugin.settings.svg.call(plugin.settings.zoom.transform,d3.zoomIdentity.translate(t,e).scale(plugin.settings.minZoom))},boxZoom=function(t,e,n,o){hideTooltip(),showLocationsInList("",o.NAME_1),g("select#State").val(o.NAME_1);var o=t[0],t=t[1],i=Math.abs(o[0]-t[0]),o=Math.abs(o[1]-t[1]),t=e[0],e=e[1],n=(i*=1+n/100,o*=1+n/100,jQuery("svg").width()/i),i=jQuery("svg").height()/o,o=Math.min(n,i),o=Math.min(o,plugin.settings.maxZoom),n=(o=Math.max(o,plugin.settings.minZoom))*t,i=o*e,t=Math.min(0,jQuery("svg").width()/2-n),e=Math.min(0,jQuery("svg").height()/2-i),t=Math.max(jQuery("svg").width()-plugin.settings.w*o,t),e=Math.max(jQuery("svg").height()-plugin.settings.h*o,e);plugin.settings.svg.transition().duration(400).call(plugin.settings.zoom.transform,d3.zoomIdentity.translate(t,e).scale(o))},getCircleColor=function(t){var e="#005590";if(void 0!==t.Tag){for(var n=[],o=0;o<t.Tag.length;o++)n.push(t.Tag[o].LocationsTag.tag_id);switch(n.join("-")){case"5":e=gradient_colors[0];break;case"6":e=gradient_colors[2];break;case"7":e=gradient_colors[1];break;case"5-6":case"6-5":e="url(#grad_red_yellow)";break;case"7-5":case"5-7":e="url(#grad_red_blue)";break;case"6-7":case"7-7":e="url(#grad_blue_yellow)";break;case"5-7-6":case"5-6-7":case"7-6-5":e="url(#grad_red_blue_yellow)"}}return e},selectState=function(){var t=document.getElementById("State").value;"Alle"!=t?document.getElementById("country"+t).dispatchEvent(new Event("click")):countriesGroup.selectAll(".country-on").classed("country-on",!1),""==t&&(t="All"),hideTooltip(),showLocationsInList("",t)},selectTag=function(){var t=document.getElementById("Tags").value;"Alle"!=t?(jQuery("circle.country_circle").hide(),jQuery("circle.country_circle[data-tags*='"+t+"']").show()):jQuery("circle.country_circle").show(),hideTooltip(),showLocationsInList(t,"")},showLocationsForState=function(t,e){if("Alle"!=t){plugin.settings.circleGroup.selectAll("circle").remove();for(var n=[],o=0;o<e.length;o++)e[o].Location.federal_state==t&&n.push(e[o])}else n=e;plugin.settings.circleGroup.selectAll("circle").data(n).enter().append("svg:circle").style("fill",function(t){return getCircleColor(t)}).attr("class","country_circle").attr("cx",t=>plugin.settings.projection([t.Location.longitude,t.Location.latitude])[0]).attr("cy",t=>plugin.settings.projection([t.Location.longitude,t.Location.latitude])[1]).attr("r",3).attr("data-tags",function(t,e){var n="";if(void 0!==t.Tag)for(e=0;e<t.Tag.length;e++)n+=t.Tag[e].name+" ";return n}).attr("data-state",function(t,e){return t.Location.federal_state}).on("mouseover",function(t,e){showTooltip(t)}).on("mouseout",function(t,e){}).on("mousemove",function(){var t=d3.event.pageX,e=d3.event.pageY;d3.select("#global_tooltip").style("left",t+10+"px").style("top",e+10+"px")})},showLocationsInList=function(t="",e=""){var n=[];""!=e&&showLocationsForState(e,plugin.settings.allLocations);for(var o=0;o<plugin.settings.allLocations.length;o++)if(""!=e)plugin.settings.allLocations[o].Location.federal_state==e&&n.push({ID:plugin.settings.allLocations[o].Location.id,Name:plugin.settings.allLocations[o].Location.name});else if(""!=t)for(var i=0;i<plugin.settings.allLocations[o].Tag.length;i++)plugin.settings.allLocations[o].Tag[i].name==t&&n.push({ID:plugin.settings.allLocations[o].Location.id,Name:plugin.settings.allLocations[o].Location.name});jQuery("#location_list_view").html('<li><a href="openlocation.php" class="bind-ID" target="_blank"><span class="bind-Name"></span></a></li>'),jQuery("#location_list_view li").view(n)},showTooltip=function(t){var e="";if(void 0!==t.Tag)for(var n=0;n<t.Tag.length;n++)e+=t.Tag[n].name+"<br/>";var o={tooltip_headline:t.Location.name,tooltip_city:t.Location.plz+" "+t.Location.city,tooltip_street:t.Location.street,tooltip_state:t.Location.federal_state,tooltip_tags:e,ID:t.Location.id};jQuery("div#global_tooltip").view(o),jQuery("#global_tooltip").stop().fadeIn(100)},hideTooltip=function(){jQuery("#global_tooltip").stop().fadeOut(100)},jQuery(window).resize(function(){var t=jQuery("#map-holder");plugin.svg.attr("width",jQuery(t).width()).attr("height",jQuery(t).height()),initiateZoom()}),drawMap=function(t,e,n){plugin.settings.allLocations=n.locations,plugin.settings.countriesGroup.append("rect").attr("x",0).attr("y",0).attr("width",plugin.settings.w).attr("height",plugin.settings.h),plugin.settings.countriesGroup.selectAll("path").data(e.features).enter().append("path").attr("d",plugin.settings.path).attr("id",function(t,e){return"country"+t.properties.NAME_1}).attr("class","country").on("mouseover",function(t,e){d3.select("#countryLabel"+t.properties.NAME_1).style("display","block")}).on("mouseout",function(t,e){d3.select("#countryLabel"+t.properties.NAME_1).style("display","none")}).on("click",function(t,e){d3.selectAll(".country").classed("country-on",!1),d3.select(this).classed("country-on",!0),boxZoom(plugin.settings.path.bounds(t),plugin.settings.path.centroid(t),20,t.properties)}).on("mousedown",function(){hideTooltip()});var o=[];o.push("Alle");for(var i=0;i<e.features.length;i++)o.push(e.features[i].properties.NAME_1);jQuery("#State").view(o);for(i=0;i<e.features.length;i++){for(var s=0,a=e.features[i].properties.NAME_1,l=0;l<plugin.settings.allLocations.length;l++)plugin.settings.allLocations[l].Location.federal_state==a&&s++;jQuery('#State option[value="'+a+'"]').text(a+" ("+s+")")}jQuery('#State option[value="Alle"]').text("Alle ("+plugin.settings.allLocations.length+")");showLocationsForState("Alle",plugin.settings.allLocations),g("#State").val("Alle").trigger("click");var r=[];r.push("Alle");for(i=0;i<n.locations.length;i++)if(void 0!==n.locations[i].Tag)for(l=0;l<n.locations[i].Tag.length;l++)r.includes(n.locations[i].Tag[l].name)||r.push(n.locations[i].Tag[l].name);1<r.length?jQuery("#Tags").view(r):(jQuery("#Tags").hide(),jQuery(".label_tags").hide()),initiateZoom()},d3.queue().defer(d3.json,"./json/dataBundesLander.json").defer(d3.json,"./json/ib_locations_short.json").await(function(t,e,n){if(t)throw t;drawMap(t,e,n)}),plugin.init()},g.fn.ibMap=function(t){return this.each(function(){null==g(this).data("ibMap")&&(plugin=new g.ibMap(this,t),g(this).data("ibMap",plugin))})}}(jQuery);